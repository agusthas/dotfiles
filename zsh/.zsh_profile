#!/usr/bin/env zsh

## -- PATHS --
typeset -U path
path+=($HOME/bin)

export FZF_COMPLETION_TRIGGER=','
function _fzf_compgen_path() {
  bfs -follow \
    -exclude -name .git -a -exclude -name .hg -exclude -name .svn -a \( -type d -o -type f -o -type l \) \
    -a -not -path "$1" -print 2> /dev/null | sed 's@^\./@@'
}
function _fzf_compgen_dir() {
  bfs -follow \
  -exclude -name .git -a -exclude -name .hg -exclude -name .svn -a -type d \
  -a -not -path "$1" -print 2> /dev/null | sed 's@^\./@@' 
}

export FZF_DEFAULT_OPTS=$FZF_DEFAULT_OPTS"
--prompt='❯ '
--pointer='-'
--marker='+'
--tabstop=4
--color=dark
--color=hl:2:bold,fg+:4:bold,bg+:-1,hl+:2:bold,info:3:bold,border:8,prompt:2,pointer:5,marker:1,header:6
--bind 'ctrl-s:toggle,tab:down,btab:up,ctrl-d:preview-down,ctrl-u:preview-up'
"

## -- ALIASES --
alias :q="exit"
alias ga="git add"
alias gba="git branch -a"
alias gst="git status"
alias gc="git commit -v"
alias groot='cd "$(git rev-parse --show-toplevel || echo .)"'
alias gwip='git add -A; git rm $(git ls-files --deleted) 2> /dev/null; git commit --no-verify --no-gpg-sign -m "--wip-- [skip ci]"'
alias gunwip='git log -n 1 | grep -q -c "\--wip--" && git reset HEAD~1'
alias glog="git log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative"
alias gsw="git switch"
alias gfo="git fetch origin"
# alias gundo="git reset --soft HEAD~1"
alias gpristine='git reset --hard && git clean --force -dfx'
# alias getrandom='openssl rand -base64 32'

# extra plugins
# fzf-git
if [[ -f ~/.fzf-git/fzf-git.sh ]]; then
  source ~/.fzf-git/fzf-git.sh

  # Mac terminal ctrl-/ is not working
  _fzf_git_fzf() {
    fzf-tmux -p80%,60% -- \
      --layout=reverse --multi --height=50% --min-height=20 --border \
      --border-label-pos=2 \
      --color='header:italic:underline,label:blue' \
      --preview-window='right,50%,border-left' \
      --bind='ctrl-r:change-preview-window(down,50%,border-top|hidden|)' "$@"
  }

  gco() {
    local selected=$(_fzf_git_each_ref --no-multi)
    [ -n "$selected" ] && git checkout "$selected"
  }
fi