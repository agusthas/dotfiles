#!/usr/bin/env zsh

## -- PATHS --
typeset -U path
path+=($HOME/bin)

case $(uname) in
  Darwin)
    # commands for OS X go here
    __clip_cmd="pbcopy"
  ;;
  Linux)
    # path=($HOME/.fnm $path)
    # export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/ssh-agent.socket"
    __clip_cmd="xclip -selection clipboard"
  ;;
esac

if [[ -n $SSH_CONNECTION ]]; then
  if command -v doitclient >/dev/null 2>&1; then
    __clip_cmd="doitclient wclip"
  fi
fi

# Preferred editor
if command -v nvim >/dev/null 2>&1; then
  export EDITOR='nvim'
else 
  export EDITOR='vim'
fi

export FZF_DEFAULT_OPTS="--height 50% --reverse --bind 'ctrl-d:preview-down,ctrl-u:preview-up,ctrl-y:execute-silent(echo {} | ${__clip_cmd:-''})+abort' --preview-window wrap --preview '(bat --color=always --plain {} 2>/dev/null || exa -1 --group-directories-first --color=always {} 2>/dev/null || echo {})'"
export WORKSPACES_LIST_PATH="$HOME/.workspaces_list" # MUST BE DEFINED

## -- ALIASES --
alias :q="exit"
alias getrandom='openssl rand -base64 32'
alias lg='lazygit'
alias dco='docker compose'

## -- FUNCTIONS --
# Docker
# remove image include multi options
function drmi() {
  docker images \
    | fzf -q "$1" --header-lines=1 --no-sort -m --tac --prompt="Choose image(s) to remove: " \
    | awk '{print $3}' \
    | xargs -I {} docker rmi {}
}

# remove volume include multi options
function drmv() {
  docker volume ls \
    | fzf -q "$1" --header-lines=1 --no-sort -m --tac --prompt="Choose volume(s) to remove: " \
    | awk {'print $2'} \
    | xargs -I {} docker volume rm {}
}

# Remove commented command from history
function zshaddhistory() {
  emulate -L zsh
  if ! [[ "$1" =~ "(^ |^clear)" ]] ; then
    print -sr -- "${1%%$'\n'}"
    fc -p
  else
    return 1
  fi
}

bindkey '^[#' pound-insert
bindkey -s ^f 'tms\n'
