#!/usr/bin/env bash

tmpfile=/tmp/jqreplinput

cleanup() {
  [[ -e "$tmpfile" ]] && rm "$tmpfile"
}

if [[ -z $1 ]] || [[ $1 == "-" ]]; then
  input=$tmpfile
  trap cleanup SIGHUP SIGINT SIGTERM EXIT
  cat /dev/stdin > "$input"
else
  input=$1
fi

echo '' \
  | fzf --disabled \
      --preview-window="down:90%" \
      --height=99% \
      --no-info \
      --print-query \
      --reverse \
      --preview "jq --color-output -r {q} $input" \
      --query="." \